# Free Flyer application
Many files are present in two version (with and without "_time" suffix). This is done just for convenience in the initial phase of the generalization of the model.

## Repo structure
1. ./dataset/
    - Folder containing the dataset used for training and testing eventually relative to different scenario.

2. ./dataset_generation/
    - dataset_pargen.py : script to generate the datatsets
    - dataset_pargen_time.py : script to generate the datatsets characterized by different final time and number of timesteps
    - preprocessing.py : pre-processing script to convert the dataset generated by dataset_pargen.py in torch Tensors
    - preprocessing_time.py : pre-processing script to convert the dataset generated by dataset_pargen_time.py in torch Tensors

3. ./decision_transformer/
    - ./saved_files/checkpoints : directory for transformer's models
    - art_closed_loop.py : classes to use transformers in closed-loop (CLOSED-LOOP)
    - art.py : class definition of the transformer, both for the version with constant and variable final time (**OPEN-LOOP**)
    - dagger_training_tracker.ipynb : notebook to keep track of training progresses (both **OPEN-LOOP** and CLOSED-LOOP)
    - dagger_training.py : DAGGER training to fina tune the open-loop model on closed-loop data (CLOSED-LOOP)
    - main_eval_compact_time.ipynb : notebook to test the open-loop model with variable final time (**OPEN-LOOP**) --> Useful to check if the model can recreate trajectories sampled from the dataset using the true conditioning parameters (hence the one corresponding to the sample itself)
    - main_eval_compact.ipynb : notebook to test the open-loop model (**OPEN-LOOP**) --> Useful to check if the model can recreate trajectories sampled from the dataset using the true conditioning parameters (hence the one corresponding to the sample itself)
    - main_train_time.ipynb : notebook to try the open-loop training in an interactive way for the model with variable final time (**OPEN-LOOP**)
    - main_train.ipynb : notebook to try the open-loop training in an interactive way (**OPEN-LOOP**)
    - main_train_time.py : open-loop training script for models with variable final time (**OPEN-LOOP**)
    - main_train.py : open-loop training script (**OPEN-LOOP**)
    - manage_time.py : file defining Dataset classes and functions to quickly intercat with the data and the transformer when having different final times (**OPEN-LOOP**)
    - manage.py : file defining Dataset classes and functions to quickly intercat with the data and the transformer (**OPEN-LOOP**)
    - test_closed_loop_time.ipynb : notebook to test the functioning of OPEN-LOOP warmstarting+optimization (first cells of the notebook) and CLOSED-LOOP receding-horizon control (second half of the cells) for the models with variable final time --> very useful to use the first cells to test the model to warmstart the optimization problem 
    - test_closed_loop.ipynb : notebook to test the functioning of OPEN-LOOP warmstarting+optimization (first cells of the notebook) and CLOSED-LOOP receding-horizon control (second half of the cells) --> very useful to use the first cells to test the model to warmstart the optimization problem 

4. ./dynamics/
    - FreeflyerEnv.py : class defining the interactive environment for usage in cloed-loop (CLOSED-LOOP)
    - file.ipynb and file_time.ipynb : notebook to test functionalities of freeflyer.py and freeflyer_time.py
    - freeflyer_time.py : class definition of the freeflyer dynamics and optimization problem when having variable final times (**OPEN-LOOP**)
    - freeflyer.py : class definition of the freeflyer dynamics and optimization problem (**OPEN-LOOP**)

5. ./optimization/
    - dagger_analysis_plotting.ipynb : notebook to plot results from the planning horizon analysis (CLOSED-LOOP)
    - ff_scenario_time.py : file containing specification for the problem with variable final time (such as mass, force of the thrusters, possible final times, ..) (**OPEN-LOOP**)
    - ff_scenario.py : file containing specification for the problem with constant final time (such as mass, force of the thrusters, constant final time, ..) (**OPEN-LOOP**)
    - planning_horizon_analysis_dagger_time.py : script to perform the analysis of computational-times for the closed-loop performances varying the planning horizon (CLOSED-LOOP)
    - planning_horizon_analysis_dagger.py : script to perform the analysis of closed-loop performances varying the planning horizon (CLOSED-LOOP)
    - plotting_warmstarting_analysis.ipynb : notebook to plot warmstarting analysis (OPEN-LOOP)
    - warmstarting_analysis_time.py : script to analyse the warmstarting performances of the transformer compared to convex-relaxation for the model with varying final time (**OPEN-LOOP**)
    - warmstarting_analysis.py : script to analyse the warmstarting performances of the transformer compared to convex-relaxation (**OPEN-LOOP**)

## Suggestions
1. Paste dataset_folder in *./datatset/*
2. Paste transformer model in *./decision_transformer/saved_files/checkpoints/*
3. Start using ***main_eval_compact.ipynb/main_eval_compact_time.ipynb*** for an easy interface with the dataset and the transformer (if using variable final times make sure to specify the correct dataset_scenario variable in ***freeflyer_time.py***, e.g. if the dataset used is the one with final times = 60s or 80s, i.e. "time_40_60", the dataset_scenario variable in ***freeflyer_time.py*** should be "time_40_60")
4. Checkout the ***freeflyer.py/freeflyer_time.ipynb*** file to understand the optimization problems and the dynamics
5. Look at the ***manage.py/manage_time.py*** file for a more in-depth comprehension on how to import datasets/model and use the model at inference
6. Look at ***main_train.py/main_train_time.py*** for a more in-depth comprehension on hor to train the model which is available in ***art.py***
7. Look at ***dataset_pargen.py/dataset_pargen_time.py*** and ***preprocessing.py/preprocessing_time.py*** to understand how to create the datasets
8. Look at ***test_closed_loop.ipynb/test_closed_loop_tiime.ipynb*** to understand how to perform warmstart
